const form = document.getElementById('loginForm');
const submitBtn = document.getElementById('submitBtn');
const feedback = document.getElementById('feedback');

const toggleBtn = document.getElementById('togglePassword');
const passwordInput = document.getElementById('password');

toggleBtn.addEventListener('click', () => {
    const isHidden = passwordInput.type === 'password';
    passwordInput.type = isHidden ? 'text' : 'password';
    toggleBtn.textContent = isHidden ? 'Vidljiva ≈°ifra üëÅÔ∏è' : 'Skrivena ≈°ifra üôà';
  });

function setFeedback(type, msg) {
  console.log(type + ": " + msg);
  if (!msg) { feedback.innerHTML = ''; return; }
  feedback.innerHTML = msg;
}

form.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const email = form.email.value;
    const password = form.password.value;

    if (!email){
      setFeedback('error', 'Upi≈°ite elektroniƒçku po≈°tu');
      return;
    }
    if (!password){
      setFeedback('error', 'Upi≈°ite lozinku');
      return;
    }

    setFeedback('success', 'Ulazite...');

    try {
      const res = await fetch("/auth/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password })
      });

      const data = await res.json();

      if (!res.ok) {
        setFeedback("error", data.error || "Neispravni podaci");
        return;
      }

      //spremi token i user info privremeno u localStorage
      localStorage.setItem("token", data.token);
      localStorage.setItem("user", JSON.stringify(data.user));

      setFeedback("success", "Uspje≈°na prijava!");
      console.log("‚úÖ Logged in:", data);
  
      //preusmjeri na poƒçetnu
      window.location.href = "/";
    } catch (err) {
      console.error(err);
      setFeedback("error", "Gre≈°ka u komunikaciji s poslu≈æiteljem");
    }
});
